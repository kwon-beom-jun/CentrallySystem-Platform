# 메일 발송 시나리오

**🌐 API 엔드포인트 요약**

| 구분 | 메서드 | 경로 | 요청 바디 | 설명 |
| --- | --- | --- | --- | --- |
| 회원가입 | POST | `/email/send` | `{ email }` | 인증코드 발송 (이미 사용 중인 이메일이면 거절) |
| 회원가입 | POST | `/email/verify` | `{ email, code }` | 코드·만료 검증 (성공 시 "이메일 인증 성공") |
| 비번 찾기 | POST | `/email/reset/send` | `{ email }` | 인증코드 발송 (존재하는 사용자만) |
| 비번 찾기 | POST | `/email/reset/confirm` | `{ email, code }` | 코드 검증 + 임시 비밀번호 생성·저장·메일 발송 |

### **메일 발송 개요**

---

- **목적**: 회원가입 이메일 인증, 비밀번호 찾기(임시 비밀번호 발급), 소셜 연동 알림
- **인증 코드**: 6자리 숫자, 유효 기간 5분, 검증 성공 시 DB에 verified=true

### **언제 발송되는가**

---

- **회원가입**: "인증 메일" 클릭 → 인증코드 발송, "확인" 클릭 → 코드 검증

**도식 1: 회원가입 인증 메일 흐름**

```
1. 사용자: 인증 메일 클릭
   ↓
2. 웹앱: POST /email/send 호출
   ↓
3. Auth: 6자리 코드 생성
   ↓
4. DB 저장 (만료 5분, verified false)
   ↓
5. 인증코드 메일 발송
   ↓
6. 사용자: 코드 입력
   ↓
7. 웹앱: POST /email/verify 호출
   ↓
8. Auth: 코드와 만료 검증
   ↓
9. DB 업데이트 (verified true)
   ↓
10. 웹앱: 인증 완료 표시
```

**API 엔드포인트 요약**

- POST `/email/send` { email } → 인증코드 발송(이미 사용 중인 이메일이면 거절)
- POST `/email/verify` { email, code } → 코드·만료 검증(성공 시 "이메일 인증 성공")
    

- **비밀번호 찾기**: "인증 메일 발송" → 인증코드 발송, "확인" → 코드 검증 + 임시 비밀번호 메일 발송

**도식 2: 비밀번호 찾기(인증코드 → 임시 비밀번호)**

**1단계: 인증코드 발송**

```
사용자
  └─→ 웹앱: 인증 메일 발송 클릭
      └─→ Auth 서비스: POST /email/reset/send {email}
          └─→ 웹앱: OK (코드 발송 완료)
```

**2단계: 임시 비밀번호 발급**

```
사용자
  └─→ 웹앱: 코드 입력 후 확인
      └─→ Auth 서비스: POST /email/reset/confirm {email, code}
          └─→ 웹앱: OK (임시 비밀번호 메일 발송)
```

**API 엔드포인트 요약**

- POST `/email/reset/send` { email } → 인증코드 발송(존재하는 사용자만)
- POST `/email/reset/confirm` { email, code } → 코드 검증 + 임시 비밀번호 생성·저장·메일 발송
    

- **소셜 연동(옵션)**: 연동 완료 시 알림 메일 발송(카카오는 추후 알림톡 전환 예정)

### **메일 제목/본문(요지)**

- **인증코드 메일**
- 제목: “[Centrally] 이메일 인증 코드 안내 : {코드}”
- 본문: “인증 코드: {코드}”, “유효기간: 5분”
- **임시 비밀번호 메일**
- 제목: “[Centrally-System] 임시 비밀번호 안내”
- 본문: “임시 비밀번호: {12자 영문/숫자}”, “로그인 후 비밀번호 변경”
- **소셜 연동 안내**
- 제목: “[Centrally-System] 소셜 계정 연동 안내”
- 본문: “[{이메일}]과 {소셜} 계정 연동 완료”

### **유효기간/검증 동작**

- 발급 시각 + 5분 만료
- 검증 성공 시 verified=true 저장
- 비밀번호 찾기 확정 시 임시 비밀번호 생성·해시 저장·메일 발송

### **프론트 UX 흐름(요약)**

- **회원가입**: 발송 후 300초 타이머, 검증 성공 시 입력 비활성화, 가입 시 verificationCode 포함
- **비번 찾기**: 발송 → 코드 검증 → 임시 비밀번호 메일 수신

**도식 3: 백엔드 처리(회원가입: 인증코드 발송)**

```
요청: POST /email/send
  ↓
이메일 중복 확인
  ↓
6자리 코드 생성
  ↓
DB 저장 (만료 5분, verified false)
  ↓
인증코드 메일 발송
  ↓
응답: 인증 코드 발송됨
```

**도식 4: 백엔드 처리(비밀번호 찾기: 코드 발송 → 임시 비밀번호)**

**상단: reset send 요청**

```
reset send 요청
  ↓
이메일 확인
  ↓
코드 생성
  ↓
DB 저장
  ↓
메일 발송
  ↓
응답
```

**하단: reset confirm 요청**

```
reset confirm 요청
  ↓
코드 검증
  ↓
임시 비밀번호 생성
  ↓
비밀번호 저장
  ↓
메일 발송
  ↓
완료
```

### **운영/보안 메모**

- **레이트리밋**: 발송/검증 시도 횟수 제한 권장
- **브루트포스 방지**: 쿨다운·캡차 적용 추천
- **저장 보안**: 코드 평문 최소화(가능 시 해싱), 감사 로그
- **SMTP 관리**: 환경별 자격증명·TLS 설정 점검
- 간단 요약
- 회원가입/비번찾기는 인증코드 메일로 본인확인, 비번찾기는 검증 성공 시 임시 비밀번호 메일 발송. 모든 흐름은 6자리·5분 유효·검증 상태 저장으로 일관되며, 프론트는 명시적 호출과 타이머/안내로 UX를 구성함