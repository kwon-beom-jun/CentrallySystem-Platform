# RECEIPT 서비스 개요

<br>

## 📋 개요

RECEIPT 서비스는 기업의 영수증 디지털화 및 결재 프로세스 관리를 담당하는 마이크로서비스입니다. 직원들이 제출한 영수증을 디지털 형태로 관리하고, 다단계 결재 프로세스를 통해 승인/반려 처리를 합니다.

<br>

## 🔧 주요 기능

### 1. 영수증 관리

**역할:** 영수증의 생성, 조회, 수정, 삭제를 관리합니다.

- 영수증 등록 및 제출
- 영수증 조회 (개인별, 상태별, 기간별)
- 영수증 수정 및 삭제
- 영수증 코드 자동 생성 (YYMM-번호 형식)
- 영수증 상태 관리

#### 영수증 상태
- **WAITING**: 대기 (결재 시작 전)
- **REQUEST**: 신청 (결재 진행 중)
- **APPROVED**: 승인 (전원 승인 완료)
- **REJECTED**: 반려 (결재 도중 반려)
- **CLOSED**: 마감 (지급까지 완료)

<br>

### 2. 결재 승인 라인 관리

**역할:** 영수증 결재를 위한 다단계 승인 라인을 관리합니다.

- 결재 라인 생성 및 설정
- 결재 단계별 순서 관리
- 결재 역할 구분 (결재, 합의 등)
- 현재 결재 단계 추적
- 결재 이력 관리

<br>

### 3. 승인/반려 처리

**역할:** 영수증에 대한 승인 및 반려 처리를 관리합니다.

- 결재자별 승인 처리
- 반려 처리 및 반려 사유 관리
- 다음 단계 결재자 자동 지정
- 결재 완료 시 최종 승인 처리
- 대리 승인 처리

<br>

### 4. 카테고리 관리

**역할:** 영수증 목적별 카테고리 및 한도를 관리합니다.

- 카테고리 생성, 수정, 삭제
- 카테고리별 상한 금액 설정
- 영수증 등록 시 카테고리 선택
- 카테고리별 한도 체크

<br>

### 5. 기본 결재자 관리

**역할:** 사용자별 기본 결재자를 설정하여 영수증 제출 시 자동으로 결재 라인을 구성합니다.

- 기본 결재자 설정 (단계별)
- 부서/팀별 기본 결재자 관리
- 영수증 제출 시 기본 결재자 자동 할당

<br>

### 6. 결재자 위임 관리

**역할:** 결재자의 부재 시 다른 사용자에게 결재 권한을 위임할 수 있는 기능을 제공합니다.

- 결재 권한 위임 설정
- 위임 기간 설정 (시작일, 종료일)
- 위임된 결재자로 승인 처리
- 위임 해제 및 취소

<br>

### 7. 결재자 즐겨찾기 관리

**역할:** 자주 사용하는 결재자를 즐겨찾기로 등록하여 빠르게 결재 라인에 추가할 수 있습니다.

- 결재자 즐겨찾기 추가/삭제
- 즐겨찾기 결재자 목록 조회
- 영수증 제출 시 즐겨찾기 결재자 선택

<br>

### 8. 참여자 관리

**역할:** 영수증과 관련된 참여자 정보를 관리합니다.

- 내부 참여자 등록 (회사 직원)
- 외부 참여자 등록 (외부 인원)
- 참여자 정보 관리 (이름, 회사, 직책, 연락처 등)
- 영수증별 참여자 목록 관리

<br>

### 9. 마감 관리

**역할:** 월급 지급을 위한 영수증 마감 처리를 관리합니다.

- 개인별 마감 처리
- 마감 날짜별 영수증 집계
- 마감별 총 금액 계산
- 마감 비고 관리

<br>

### 10. 첨부파일 관리

**역할:** 영수증에 첨부된 파일을 관리합니다.

- 영수증 이미지 업로드
- 파일 타입 관리
- 파일 원본명 및 저장명 관리
- 파일 URL 관리
- 이미지 처리 (썸네일 생성 등)

<br>

### 11. 엑셀 리포트

**역할:** 영수증 데이터를 엑셀 형식으로 다운로드하여 보고서를 생성합니다.

- 승인 완료 영수증 엑셀 다운로드
- 결재 현황 요약 리포트
- 사용자별 영수증 요약 리포트
- 연도별 영수증 집계 리포트
- CEO 리포트 (관리자용)

<br>

### 12. 조직 동기화

**역할:** HRM 서비스의 조직 구조 변경 사항을 동기화합니다.

- 부서명 변경 동기화
- 팀명 변경 동기화
- 부서/팀 삭제 동기화
- 사용자 부서/팀 변경 동기화
- 영수증 및 결재 라인의 조직 정보 자동 업데이트

<br>

### 13. 메일 알림 기능

**역할:** 영수증 결재 과정에서 관련자들에게 자동으로 알림 메일을 발송합니다.

- 영수증 제출 시 첫 번째 결재자에게 알림
- 다음 결재 단계로 진행 시 결재자에게 알림
- 반려 시 관련자(기승인자 + 제출자)에게 알림
- 승인 완료 시 제출자에게 알림

**특징:**
- 메일 발송 기능은 설정에 따라 활성화/비활성화 가능
- 현재는 주석 처리되어 있으나 구조는 완성되어 있음

<br>

### 14. 검색 및 필터링

**역할:** 다양한 조건으로 영수증을 검색하고 필터링합니다.

- 사용자별 검색
- 상태별 검색
- 기간별 검색
- 카테고리별 검색
- 금액 범위별 검색
- 복합 조건 검색

<br>

## 🔄 Kafka 이벤트 통신

### 수신 이벤트 (Consumer)

#### HRM 서비스 이벤트
- **사용자 조직 변경**: 사용자의 부서/팀 변경 시 영수증의 조직 정보 자동 업데이트
- **부서명 변경**: 부서명 변경 시 영수증 및 결재 라인의 부서명 자동 업데이트
- **팀명 변경**: 팀명 변경 시 영수증 및 결재 라인의 팀명 자동 업데이트
- **부서/팀 삭제**: 조직 삭제 시 관련 데이터 처리

<br>

## 📌 주요 특징

### 1. 다단계 결재 프로세스
- 단계별 결재 라인 구성
- 순차적 결재 진행
- 각 단계별 승인 상태 추적

### 2. 영수증 코드 자동 생성
- 월별 시퀀스 번호 자동 생성 (YYMM-번호)
- 동시성 제어를 통한 안전한 코드 생성

### 3. 결재자 위임 기능
- 일시적 결재 권한 위임
- 위임 기간 설정
- 대리 승인 처리

### 4. 조직 구조 실시간 동기화
- HRM 서비스의 조직 변경 시 자동 동기화
- 영수증 및 결재 라인의 조직 정보 자동 업데이트

### 5. 카테고리별 한도 관리
- 목적별 영수증 분류
- 카테고리별 상한 금액 설정 및 관리

### 6. 엑셀 리포트 제공
- 다양한 형식의 리포트 생성
- 관리자용 집계 리포트
- 데이터 분석 및 통계

<br>

## 🔗 관련 서비스와의 연동

### HRM 서비스
- 조직 구조(부서/팀) 변경 사항 실시간 동기화
- 사원 정보 조회 (이름, 부서, 팀 등)
- 영수증 제출 시 사원 정보 활용

### Auth 서비스
- 사용자 인증 및 권한 확인
- 결재 권한 검증

<br>

## 💡 활용 사례

- **영수증 제출**: 직원이 영수증을 디지털로 제출
- **결재 처리**: 관리자가 영수증을 승인 또는 반려
- **마감 처리**: 월급 지급 전 영수증 마감 및 집계
- **현황 파악**: 관리자가 부서별/개인별 영수증 현황 조회
- **엑셀 리포트**: 회계팀에서 월별/연도별 영수증 데이터 추출
- **결재 위임**: 부재 시 다른 사용자에게 결재 권한 위임

<br>

